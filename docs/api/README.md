# RC Constru√ß√µes - API Documentation
## Sistema de Gest√£o para Constru√ß√£o Civil v5.1

<div align="center">

![RC Constru√ß√µes](https://img.shields.io/badge/RC%20Constru√ß√µes-v5.1-blue?style=for-the-badge)
![Node.js](https://img.shields.io/badge/Node.js-18+-green?style=for-the-badge&logo=node.js)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-blue?style=for-the-badge&logo=postgresql)
![PWA](https://img.shields.io/badge/PWA-Ready-purple?style=for-the-badge)
![Docker](https://img.shields.io/badge/Docker-Enabled-blue?style=for-the-badge&logo=docker)

**Sistema completo de gest√£o para empresas de constru√ß√£o civil com funcionalidades PWA, sincroniza√ß√£o offline e API REST robusta.**

</div>

---

## üìã √çndice

- [üéØ Vis√£o Geral](#-vis√£o-geral)
- [üèóÔ∏è Arquitetura](#Ô∏è-arquitetura)
- [üöÄ Quick Start](#-quick-start)
- [üìö Documenta√ß√£o da API](#-documenta√ß√£o-da-api)
- [üîê Autentica√ß√£o](#-autentica√ß√£o)
- [üí° Funcionalidades](#-funcionalidades)
- [üõ†Ô∏è Tecnologias](#Ô∏è-tecnologias)
- [üê≥ Docker](#-docker)
- [üìä Monitoramento](#-monitoramento)
- [üß™ Testes](#-testes)
- [ü§ù Contribui√ß√£o](#-contribui√ß√£o)

---

## üéØ Vis√£o Geral

O **RC Constru√ß√µes** √© um sistema completo de gest√£o empresarial desenvolvido especificamente para empresas de constru√ß√£o civil. O sistema oferece:

### ‚ú® Principais Caracter√≠sticas

- üì± **Progressive Web App (PWA)** - Funciona offline e pode ser instalado
- üîÑ **Sincroniza√ß√£o Autom√°tica** - Dados sincronizados entre dispositivos
- üèóÔ∏è **M√≥dulos Especializados** - Dashboard, clientes, contratos, or√ßamentos e financeiro
- üîê **Autentica√ß√£o Robusta** - JWT com diferentes n√≠veis de acesso
- üìä **Relat√≥rios Avan√ßados** - Gr√°ficos interativos e exporta√ß√£o PDF
- üõ°Ô∏è **Seguran√ßa Avan√ßada** - Criptografia, logs de auditoria e valida√ß√£o
- üê≥ **Containerizado** - Deploy f√°cil com Docker

### üé™ Demo e Acesso

```bash
# URLs de Desenvolvimento
Frontend: http://localhost:80
Backend API: http://localhost:3001
Documenta√ß√£o: http://localhost:3001/docs

# Usu√°rios de Teste
admin / admin123          # Administrador (acesso total)
gerente / gerente123      # Gerente (gest√£o e relat√≥rios)
financeiro / financeiro123 # Financeiro (m√≥dulo financeiro)
```

---

## üèóÔ∏è Arquitetura

### Arquitetura de Alto N√≠vel

```mermaid
graph TB
    Client[PWA Frontend] --> Nginx[Nginx Reverse Proxy]
    Nginx --> API[Node.js API]
    API --> DB[(PostgreSQL)]
    API --> Cache[(Redis)]
    API --> Logs[Winston Logs]
    Client --> IndexedDB[(IndexedDB)]
    
    subgraph "Containers"
        Nginx
        API
        DB
        Cache
    end
```

### Stack Tecnol√≥gico

#### Backend
- **Runtime**: Node.js 18+
- **Framework**: Express.js
- **Database**: PostgreSQL 13+
- **Cache**: Redis 6+
- **ORM**: Sequelize
- **Authentication**: JWT + bcrypt
- **Logging**: Winston
- **Validation**: Yup

#### Frontend
- **Architecture**: SPA (Single Page Application)
- **Storage**: IndexedDB (Dexie.js)
- **Charts**: Chart.js
- **PWA**: Service Workers
- **PDF**: jsPDF
- **Security**: bcrypt.js client-side

#### DevOps
- **Containerization**: Docker + Docker Compose
- **Reverse Proxy**: Nginx
- **SSL/TLS**: Let's Encrypt ready
- **Monitoring**: Winston + Custom dashboard

---

## üöÄ Quick Start

### Pr√©-requisitos

- Node.js 18+ 
- Docker & Docker Compose
- Git

### 1. Clone e Configure

```bash
# Clone o reposit√≥rio
git clone https://github.com/your-org/rc-construcoes.git
cd rc-construcoes

# Configure vari√°veis de ambiente
cp .env.example .env
# Edite o arquivo .env com suas configura√ß√µes
```

### 2. Docker Setup (Recomendado)

```bash
# Inicie todos os servi√ßos
docker-compose up -d

# Verifique os servi√ßos
docker-compose ps
```

### 3. Desenvolvimento Local

```bash
# Backend
cd backend
npm install
npm run dev

# Frontend (novo terminal)
cd ..
python -m http.server 80  # ou nginx
```

### 4. Verifica√ß√£o

```bash
# Health check da API
curl http://localhost:3001/health

# Frontend
open http://localhost
```

---

## üìö Documenta√ß√£o da API

### üìñ Documenta√ß√£o Completa

| M√≥dulo | Descri√ß√£o | Link |
|--------|-----------|------|
| **Autentica√ß√£o** | JWT, login, logout, permiss√µes | [üìñ authentication.md](./authentication.md) |
| **Logging** | Sistema de logs, monitoramento | [üìñ logging.md](./logging.md) |
| **Sincroniza√ß√£o** | Sync offline, resolu√ß√£o de conflitos | [üìñ synchronization.md](./synchronization.md) |

### üåê Base URLs

```bash
# Produ√ß√£o
https://api.rc-construcoes.com

# Desenvolvimento  
http://localhost:3001

# Health Check
GET /health
```

### üìã Endpoints Principais

#### Autentica√ß√£o
```http
POST   /api/auth/login          # Login do usu√°rio
POST   /api/auth/register       # Registro de usu√°rio
GET    /api/auth/verify         # Verificar token
POST   /api/auth/logout         # Logout
```

#### Gest√£o de Dados
```http
# Clientes
GET    /api/clients            # Listar clientes
POST   /api/clients            # Criar cliente
GET    /api/clients/:id        # Obter cliente
PUT    /api/clients/:id        # Atualizar cliente
DELETE /api/clients/:id        # Deletar cliente

# Contratos
GET    /api/contracts          # Listar contratos
POST   /api/contracts          # Criar contrato
GET    /api/contracts/:id      # Obter contrato
PUT    /api/contracts/:id      # Atualizar contrato

# Or√ßamentos
GET    /api/budgets            # Listar or√ßamentos
POST   /api/budgets            # Criar or√ßamento
GET    /api/budgets/:id        # Obter or√ßamento
PUT    /api/budgets/:id        # Atualizar or√ßamento

# Financeiro
GET    /api/financial          # Listar transa√ß√µes
POST   /api/financial          # Criar transa√ß√£o
GET    /api/financial/reports  # Relat√≥rios financeiros
```

#### Sistema
```http
GET    /api/logs               # Listar logs (admin)
GET    /api/logs/:filename     # Visualizar log (admin)
POST   /api/sync               # Sincroniza√ß√£o de dados
GET    /api/health             # Health check
```

---

## üîê Autentica√ß√£o

### JWT Authentication

Todas as rotas protegidas requerem um token JWT v√°lido:

```javascript
// Header obrigat√≥rio
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### N√≠veis de Acesso

| Role | Permiss√µes | Descri√ß√£o |
|------|------------|-----------|
| **admin** | `["all"]` | Acesso total ao sistema |
| **manager** | `["dashboard", "clients", "contracts", "budgets", "reports"]` | Gest√£o operacional |
| **financial** | `["dashboard", "financial", "reports", "clients_view"]` | M√≥dulo financeiro |

### Exemplo de Login

```bash
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@rcconstrucoes.com",
    "password": "admin123"
  }'
```

---

## üí° Funcionalidades

### üìä Dashboard Interativo
- **M√©tricas em tempo real**: Receita, contratos ativos, novos clientes
- **Gr√°ficos din√¢micos**: Vis√£o financeira e distribui√ß√£o de contratos
- **Atividades recentes**: Timeline de a√ß√µes do sistema
- **Resumo executivo**: KPIs principais

### üë• Gest√£o de Clientes
- **CRUD completo**: Criar, listar, editar e deletar clientes
- **Informa√ß√µes detalhadas**: Dados pessoais, endere√ßo, contato
- **Hist√≥rico**: Contratos e or√ßamentos associados
- **Valida√ß√£o**: CPF, email e dados obrigat√≥rios

### üìÑ Contratos
- **Lifecycle management**: Draft ‚Üí Active ‚Üí Completed ‚Üí Canceled
- **Integra√ß√£o com clientes**: Sele√ß√£o e associa√ß√£o autom√°tica
- **Valores e datas**: Controle de prazos e valores
- **Status tracking**: Acompanhamento do progresso

### üßÆ Or√ßamentos
- **Wizard de cria√ß√£o**: Processo guiado passo a passo
- **C√°lculos autom√°ticos**: Materiais + m√£o de obra + margem
- **M√∫ltiplos servi√ßos**: Constru√ß√£o, reforma, pintura, etc.
- **Gera√ß√£o de PDF**: Or√ßamentos profissionais

### üí∞ M√≥dulo Financeiro
- **Fluxo de caixa**: Entradas e sa√≠das
- **Relat√≥rios**: An√°lises por per√≠odo e categoria
- **Gr√°ficos**: Visualiza√ß√£o de tend√™ncias
- **Exporta√ß√£o**: Dados para contabilidade

### üì± PWA Features
- **Instala√ß√£o**: App nativo via navegador
- **Offline-first**: Funciona sem internet
- **Sincroniza√ß√£o**: Dados sincronizados automaticamente
- **Notifica√ß√µes**: Alertas e lembretes

---

## üõ†Ô∏è Tecnologias

### Backend Stack

```json
{
  "runtime": "Node.js 18+",
  "framework": "Express.js 4.18+",
  "database": "PostgreSQL 13+",
  "cache": "Redis 6+",
  "orm": "Sequelize 6+",
  "auth": "jsonwebtoken + bcryptjs",
  "validation": "yup",
  "logging": "winston + winston-daily-rotate-file",
  "security": "helmet + cors + rate-limiting"
}
```

### Frontend Stack

```json
{
  "architecture": "Vanilla JS SPA",
  "storage": "IndexedDB (Dexie.js)",
  "charts": "Chart.js",
  "pdf": "jsPDF",
  "notifications": "SweetAlert2",
  "csv": "PapaParse",
  "pwa": "Service Workers",
  "security": "bcrypt.js"
}
```

### DevOps & Infrastructure

```json
{
  "containerization": "Docker + Docker Compose",
  "reverse_proxy": "Nginx",
  "ssl": "Let's Encrypt ready",
  "monitoring": "Winston + Custom dashboards",
  "testing": "Jest + Cypress",
  "ci_cd": "GitHub Actions ready"
}
```

---

## üê≥ Docker

### Desenvolvimento

```bash
# Iniciar todos os servi√ßos
docker-compose up -d

# Logs em tempo real
docker-compose logs -f

# Parar servi√ßos
docker-compose down
```

### Produ√ß√£o

```bash
# Build e deploy de produ√ß√£o
docker-compose -f docker-compose.prod.yml up -d

# Scaling
docker-compose up --scale backend=3
```

### Servi√ßos Inclu√≠dos

| Servi√ßo | Porta | Descri√ß√£o |
|---------|-------|-----------|
| **nginx** | 80, 443 | Reverse proxy + Frontend |
| **backend** | 3001 | API Node.js |
| **postgres** | 5432 | Database |
| **redis** | 6379 | Cache |

---

## üìä Monitoramento

### Health Checks

```bash
# API Health
curl http://localhost:3001/health

# Database Status  
curl http://localhost:3001/api/health/db

# Redis Status
curl http://localhost:3001/api/health/redis
```

### Logs

```bash
# Logs da aplica√ß√£o
docker-compose logs backend

# Logs do Nginx
docker-compose logs nginx

# Logs espec√≠ficos por data
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:3001/api/logs/application-2024-01-15.log
```

### M√©tricas

```bash
# M√©tricas da API
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:3001/api/logs/metrics
```

---

## üß™ Testes

### Setup de Testes

```bash
# Instalar depend√™ncias de teste
npm install --include=dev

# Executar todos os testes
npm test

# Testes com coverage
npm run test:coverage
```

### Tipos de Teste

```bash
# Testes unit√°rios
npm run test:unit

# Testes de integra√ß√£o  
npm run test:integration

# Testes E2E
npm run test:e2e
```

### Estrutura de Testes

```
tests/
‚îú‚îÄ‚îÄ unit/                 # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ auth.test.js
‚îÇ   ‚îú‚îÄ‚îÄ database.test.js
‚îÇ   ‚îî‚îÄ‚îÄ validation.test.js
‚îú‚îÄ‚îÄ integration/          # Testes de integra√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ clients-crud.test.js
‚îÇ   ‚îî‚îÄ‚îÄ contracts-flow.test.js
‚îî‚îÄ‚îÄ e2e/                  # Testes end-to-end
    ‚îú‚îÄ‚îÄ login-flow.cy.js
    ‚îî‚îÄ‚îÄ dashboard.cy.js
```

---

## üìù Configura√ß√£o

### Vari√°veis de Ambiente

```bash
# .env
NODE_ENV=production
PORT=3001

# Database
DB_HOST=postgres
DB_PORT=5432
DB_NAME=rc_construcoes_db
DB_USER=postgres
DB_PASSWORD=your_secure_password

# Redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# JWT
JWT_SECRET=your-super-secure-jwt-secret-256-bits
JWT_EXPIRES_IN=8h

# Optional
SENTRY_DSN=your_sentry_dsn
LOG_LEVEL=info
```

### Nginx Configuration

O sistema inclui configura√ß√£o Nginx otimizada com:

- **SSL/TLS**: Ready para Let's Encrypt
- **Compression**: Gzip habilitado
- **Caching**: Headers otimizados para performance
- **Security**: Headers de seguran√ßa configurados
- **Rate Limiting**: Prote√ß√£o contra DDoS

---

## üöÄ Deploy

### Deploy Manual

```bash
# 1. Clone e configure
git clone https://github.com/your-org/rc-construcoes.git
cd rc-construcoes

# 2. Configure environment
cp .env.example .env
# Edite .env com configura√ß√µes de produ√ß√£o

# 3. Deploy com Docker
docker-compose -f docker-compose.prod.yml up -d
```

### Deploy com CI/CD

O projeto inclui workflows GitHub Actions para:

- ‚úÖ **Testing**: Execu√ß√£o autom√°tica de testes
- üöÄ **Deploy**: Deploy autom√°tico para staging/production
- üîí **Security**: Scan de vulnerabilidades

---

## üìã Roadmap

### v5.2 (Pr√≥xima)
- [ ] API REST completa para mobile
- [ ] M√≥dulo de relat√≥rios avan√ßados
- [ ] Integra√ß√£o com APIs de pagamento
- [ ] Notifica√ß√µes push

### v6.0 (Futuro)
- [ ] Aplicativo mobile nativo
- [ ] IA para an√°lise de custos
- [ ] Integra√ß√£o com ERPs
- [ ] M√≥dulo de estoque

---

## ü§ù Contribui√ß√£o

### Como Contribuir

1. **Fork** o projeto
2. **Crie** uma branch para sua feature (`git checkout -b feature/nova-feature`)
3. **Commit** suas mudan√ßas (`git commit -m 'Add: nova feature'`)
4. **Push** para a branch (`git push origin feature/nova-feature`)
5. **Abra** um Pull Request

### Padr√µes de C√≥digo

```bash
# Linting
npm run lint

# Formatting
npm run format

# Type checking
npm run type-check
```

### Estrutura de Commits

```bash
feat: adiciona nova funcionalidade
fix: corrige bug
docs: atualiza documenta√ß√£o
style: formata√ß√£o de c√≥digo
refactor: refatora√ß√£o
test: adiciona/atualiza testes
chore: tarefas de build/configura√ß√£o
```

---

## üìû Suporte

### Recursos de Ajuda

- üìñ **Documenta√ß√£o**: `/docs/api/`
- üêõ **Issues**: [GitHub Issues](https://github.com/your-org/rc-construcoes/issues)
- üí¨ **Discuss√µes**: [GitHub Discussions](https://github.com/your-org/rc-construcoes/discussions)
- üìß **Email**: dev@rc-construcoes.com

### Status do Sistema

- üü¢ **API Status**: [status.rc-construcoes.com](https://status.rc-construcoes.com)
- üìä **Uptime**: 99.9% SLA
- üîÑ **Updates**: Changelog autom√°tico

---

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a [MIT License](LICENSE).

---

## üë®‚Äçüíª Equipe

Desenvolvido com ‚ù§Ô∏è pela equipe RC Constru√ß√µes.

**Vers√£o atual**: v5.1  
**√öltima atualiza√ß√£o**: Janeiro 2025  
**Node.js**: 18+  
**Status**: ‚úÖ Produ√ß√£o

---

<div align="center">

**[‚¨Ü Voltar ao topo](#rc-constru√ß√µes---api-documentation)**

</div>